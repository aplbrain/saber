{% extends "base.html" %}

{% block title %}New Experiment{% endblock %}

{% block scripts %}

<script>
var experiments = [
{% for exp in experiments %}
"{{exp}}",
{% endfor %}
];
function validate_experiment_name(){
	document.getElementById("name").classList.remove("is-invalid");
	document.getElementById("submitButton").disabled = false;
	if (experiments.includes(document.getElementById("name").value)) {
		document.getElementById("name").classList.add("is-invalid");
		document.getElementById("submitButton").disabled = true;
	}
}
function toggle_train_step(e) {
	if (e.checked) {
		document.getElementById("trainFileGroup").classList.remove("d-none");
		document.getElementById("train_file").disabled = false;
	} else {
		document.getElementById("trainFileGroup").classList.add("d-none");
		document.getElementById("train_file").disabled = true;
	}
}

</script>
{% endblock %}

{% block content %}
	<br>
	<div class="container">
		<form action="/api/experiment" method="post" enctype="multipart/form-data">
			<div class="form-group">
				<label for="name">Experiment Name</label>
				<input id="name" type="text" name="name" class="form-control" min=1 required oninput="validate_experiment_name()">
				<div class="invalid-feedback">
					Name must be unique!
				</div>
			</div>

			<div class="form-group">
				<label for="s3ImagesBucket">S3 Images Bucket</label>
				<input type="text" name="s3ImagesBucket" min=1 value="microns-phase3-isaid-patches-v2" class="form-control" required>
			</div>

			<div class="form-group">
				<label for="experiment">Experiment CSV</label>
				<input type="file" name="experiment" accept=".csv" class="form-control" required>
			</div>

			<div class="form-group">
				<label for="experiment">Additional File(s)</label>
				<input type="file" name="additional_files" class="form-control" multiple="true">
			</div>

			<div class="form-check">
				<input type="checkbox" class="form-check-input" name="has_train_step" onchange="toggle_train_step(this)">
				<label for="experiment">Include Train Step?</label>
			</div>

			<div id="trainFileGroup" class="form-group d-none">
				<label for="experiment">Training Annotations</label>
				<input type="file" name="train_file" accept=".json" class="form-control" id="train_file" disabled required>
			</div>

			<button id="submitButton" type="submit" class="btn btn-primary" disabled>Create Experiment</button>
		</form>
	</div>
{% endblock %}
